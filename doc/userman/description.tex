

\chapter{Installation}

\fclang is currently still experimental and not part of regular \framac releases. It must be built from source and added to a \framac installation.
The instructions for doing so are provided at 
\url{https://frama-c/colm/frama-clang.html}.

\fclang depends on two software packages:
\begin{itemize}
\item A current version of \framac itself
\item An installation of Clang, which is available as part of LLVM,
which itself is available from \url{http://releases.llvm.org}.
\end{itemize}

Building and installing \fclang has two effects:
\begin{itemize}
\item The \fclang executable files are installed within the \framac installation
\item The include files containing \acslpp specifications of C++ library functions
are copied to \verb|$FRAMAC_SHARE/libc| and 
\verb|$FRAMAC_SHARE/libc++|, where \verb|$FRAMAC_SHARE| is the path
given by the command \lstinline|frama-c-config -print-share-path|.
\end{itemize}.
These include files are replacements for the standard system include files.
They should have the same definitions of C and C++ functions and classes, but
with \acslpp annotations giving their specifications.

\chapter{Running the plug-in}

\section{C++ files}
Once installed the plugin is run automatically by Frama-C on any C++ files listed on the command-line. C++ files are identified by their filename suffixes. The default suffixes recognized as C++ are these:
 .cpp, .C, .cxx, .ii, .ixx, .ipp, .i++, .inl, .h, .hh

Currently this set of suffixes is compiled in the plugin (in file \texttt{frama\_Clang\_register.ml}) and can only be changed by recompiling and
reinstalling the plugin.

\section{Frama-clang executable}
The plug-in operates by invoking the executable \irg
on each file identified as C++, in turn. 
For each file it produces a temporary output file containing the C AST, which is then given as input to \framac. 
This executable is a single-file-at-a-time command-line executable only. 
Various options control its behavior.

The file-system path identifying the executable is provided by the \textbf{-cxx-clang-command <cmd>}
option and is \irg by default. The path may be absolute; if it is a relative path, it is found relative to the TODO directory. [ TODO - check this]


\section{Frama-clang options}

The options controlling \fclang are of two sorts:
\begin{itemize}
\item options known to \framac are interpreted and passed on to \fclang when
\irg is invoked, perhaps with a different option name
\item options known to \fclang directoy (and not ot \framac) must be 
included in the internal command that invokes \irg using the \option{-cpp-extra-args} option. These options are described in \S\ref{sec:standalone}.
\end{itemize}

The options known to the \fcl plugin are processed by the \fc kernel when listed on the \fc command-line. 
The use of the \fc command-line is described in the core \fc 
user guide.
There are many kernel options that affect all plugins and many options specific to \fclang.
The command \\
\centerline{\lstinline|frama-c -kernel-h|} \\
shows all kernel options; the command\\
\centerline{\lstinline|frama-c -fclang-h|} \\
shows all \fcl-specific options.

The most important of the options are these:
\begin{itemize}
	\item \option{-cpp-extra-args <string>} -- the single string argument to this option is appended to the command-line when 
	\lstinline|frama-clang| is invoked internally. It is particularly 
	important for adding include directories (\lstinline|-I|) and
	other options to be passed on to the clang compiler or the \irg executable. 
	Multiple instances of this option have a cumulative effect (rather
	than later instances replacing earlier ones). [TODO - check this]
	\item \option{-machdep <arg>} -- TODO
	\item \option{-arg <arg>} -- TODO
	\item \option{-fclang-msg-key <categories>} -- TODO
	\item \option{-fclang-warn-key <categories>} -- TODO
	\item \option{-fclang-verbose <n>} -- TODO
	\item \option{-fclang-debug <n>} -- TODO
		\item TODO
\end{itemize}

\section{Include directories}

TODO

\section{32 and 64-bit targets}

TODO


\section{Controlling output}

TODO

- make warnings errors
- stop om first error
- supplying an exisintg IRG file to frama-c

\chapter{Running the \fclang front-end standalone}
\label{sec:standalone}

In normal use within \framac, the \irg executable is
invoked automatically. However, it can also be run standalone.
In this mode it accepts command-line options and a single file;
it produces a C AST representing the translated C++, in a text format 
of the CIL (C Intermediate language).

\section{Clang options}

Frama-Clang is built on the Clang C++ parser. 
As such, the \irg executable accepts the clang
compiler options and passes them on to clang. There are many of these.
Many of these are irrelevant to \fcl as they relate to lstinline|framaCIRGen|
code generation, whereas \fcl only uses clang for parsing, name
and type resolution.
You can see a list of options by running 
\lstinline|framaCIRGen -help|

The most significant options for  \irg are these:
\begin{itemize}
	\item \option{-I <dir>} -- adds a directory to the include file search path. Using absolute paths is recommended; relative paths are relative to TODO.
	\item \option{-o <file>} -- specifies the location of the output file (that is, the file to contain the generated AST). The output path may be absolute or relative to the current working directory.
	\item \option{-std=...} -- the input programming language (default is \lstinline|-std=c++11|)
	\item \option{-w} -- suppress warnings
	\item \option{-{-}version} -- print version information
\end{itemize}

\section{Frama-Clang specific options}

There are also options that are specific to \fcl.
These are listed below:
\begin{itemize}
	\item \option{-{-}info=<n>} -- sets the level of informational messages to \textbf{n}; 0 is completely quiet; increasing values are
	more verbose. \option{-{-}info} sets the level to 1; 
	\option{-{-}no-info} sets the level to 0. The \lstinline|frama-c| option \option{-fclang-msg-key=parse} is equivalent to setting a value of 1.
	\item \option{-{-}warn=<n>} -- sets the level of parser warning messages to \textbf{n}; 0 is completely quiet; increasing values are
more verbose. \option{-{-}warn} sets the level to 1; 
\option{-{-}no-warn} sets the level to 0. The \lstinline|frama-c| option \option{-fclang-warn-key=parse} is equivalent to setting a value of 1.

	\item \option{-{-}debug=<n>} -- sets the level of parser debug messages to \textbf{n}; 0 is completely quiet; increasing values are
more verbose. \option{-{-}debug} sets the level to 1; 
\option{-{-}no-debug} sets the level to 0. 
The \lstinline|frama-c| option \option{-fclang-debug=<n>} is equivalent to setting a value of \textbf{n}.
In particular, a debug value of 1 shows the command-line that invokes \irg.
	\item \option{-{-}stop-annot-error} -- if set, then parsing stops on the first error; default is off
	\item \option{-{-}gen-impl-method} -- TODO
	\item \option{-{-}exit-code} -- if set, then the exit code of \irg is 1 if errors occur; this is not the default because then \lstinline|frama-c| would terminate upon
	any error in \lstinline|framaCIRGen|
	\item \option{-{-}no-exit-code} -- disables \option{-{-}exit-code}, so that the exit code is always 0.

\item TODO: -b -x -o -v
	
\end{itemize}


TBD - including command-line options

